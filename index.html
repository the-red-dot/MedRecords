<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>מעקב נגעי עור – ABCDE</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.5;margin:0}
  header{background:#fff;padding:12px 16px;border-bottom:1px solid #ddd;position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center}
  h1{margin:0;font-size:1.1rem}
  main{padding:16px;max-width:800px;margin:auto}
  .card{background:#f9f9f9;border:1px solid #ddd;border-radius:12px;padding:14px;margin:12px 0}
  label{font-weight:600;display:block;margin-top:8px}
  input,textarea,button,select{font-size:1rem}
  input[type="date"],input[type="text"],textarea{width:100%;padding:8px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
  textarea{min-height:80px}
  .abcde-item{background:#fff;border:1px solid #ddd;border-radius:10px;padding:10px;margin-top:8px}
  .abcde-options label{margin-right:12px}
  .actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
  button{padding:10px 14px;border:none;border-radius:8px;cursor:pointer}
  button.primary{background:#0a7cff;color:#fff;font-weight:700}
  button.secondary{background:#e9eefb;color:#0a2a5f}
  .tiny{font-size:.85rem;color:#555}
  .entry{background:#fff;border:1px solid #ddd;border-radius:10px;padding:10px;margin-top:10px}
  .badges{margin:4px 0;font-size:.85rem;color:#333}
</style>
</head>
<body>
<header>
  <h1 id="title">מעקב נגעי עור – ABCDE</h1>
  <select id="langSwitcher">
    <option value="he">עברית</option>
    <option value="ru">Русский</option>
  </select>
</header>
<main>
  <section class="card">
    <p class="tiny" id="note"></p>
    <form id="entryForm">
      <label for="date" id="lblDate"></label>
      <input id="date" name="date" type="date" required>
      <label for="title" id="lblTitle"></label>
      <input id="title" name="title" type="text">
      <label for="notes" id="lblNotes"></label>
      <textarea id="notes" name="notes"></textarea>
      <label for="photo" id="lblPhoto"></label>
      <!-- removed capture to allow gallery OR camera -->
      <input id="photo" name="photo" type="file" accept="image/*">
      
      <div id="abcdeSection"></div>

      <div class="actions">
        <button type="submit" class="primary" id="btnAdd"></button>
        <button type="button" class="secondary" id="exportBtn"></button>
        <button type="button" class="secondary" id="importBtn"></button>
        <input type="file" id="importFile" accept="application/json" hidden>
        <button type="button" class="secondary" id="clearBtn"></button>
      </div>
    </form>
  </section>

  <section class="card">
    <h2 id="myRecords"></h2>
    <div id="list"></div>
  </section>
</main>

<script>
// ================= Translations =================
const translations = {
  he:{
    title:"מעקב נגעי עור – ABCDE",
    note:"המידע נשמר לוקאלית בלבד במכשיר שלך.",
    lblDate:"תאריך",
    lblTitle:"כותרת קצרה (אופציונלי)",
    lblNotes:"תיאור/תסמינים",
    lblPhoto:"תמונה (מומלץ)",
    btnAdd:"הוסף/י תיעוד",
    btnExport:"ייצוא גיבוי",
    btnImport:"ייבוא",
    btnClear:"איפוס הכל",
    myRecords:"הרשומות שלי",
    abcde:{
      A:["אסימטריה","סימטרי","לא סימטרי"],
      B:["גבול","גבולות ברורים","גבול לא אחיד/משונן"],
      C:["צבע","צבע אחיד","מספר צבעים"],
      D:["קוטר","קטן מ-6 מ\"מ","גדול מ-6 מ\"מ"],
      E:["שינוי/התפתחות","ללא שינוי","יש שינוי"]
    }
  },
  ru:{
    title:"Мониторинг кожных поражений – ABCDE",
    note:"Данные сохраняются только локально на вашем устройстве.",
    lblDate:"Дата",
    lblTitle:"Краткий заголовок (опционально)",
    lblNotes:"Описание/симптомы",
    lblPhoto:"Фото (рекомендуется)",
    btnAdd:"Добавить запись",
    btnExport:"Экспорт резервной копии",
    btnImport:"Импорт",
    btnClear:"Очистить все",
    myRecords:"Мои записи",
    abcde:{
      A:["Асимметрия","Симметричное","Асимметричное"],
      B:["Граница","Чёткая граница","Нечёткая/неровная"],
      C:["Цвет","Один цвет","Несколько цветов"],
      D:["Диаметр","Меньше 6 мм","Больше 6 мм"],
      E:["Эволюция","Без изменений","Есть изменения"]
    }
  }
};

// ================= Helpers =================
function readFileAsDataURL(file){
  return new Promise((resolve,reject)=>{
    const r=new FileReader();
    r.onload=()=>resolve(r.result);
    r.onerror=reject;
    r.readAsDataURL(file);
  });
}

function saveEntries(entries){
  localStorage.setItem("skin_entries",JSON.stringify(entries));
}
function loadEntries(){
  try{return JSON.parse(localStorage.getItem("skin_entries")||"[]");}catch(e){return []}
}
function summarizeABCDE(entry){
  return ["A","B","C","D","E"].map(k=>k+": "+(entry.ABCDE[k]||"?")).join(" | ");
}
function renderList(){
  const list=document.getElementById("list");
  const entries=loadEntries().sort((a,b)=>(b.createdAt||0)-(a.createdAt||0));
  list.innerHTML="";
  if(entries.length===0){list.innerHTML="<p class='tiny'>אין רשומות.</p>";return;}
  for(const e of entries){
    const div=document.createElement("div");div.className="entry";
    const h=document.createElement("h3");
    h.textContent=(e.date||"")+" – "+(e.title||"");
    div.appendChild(h);
    const badges=document.createElement("div");badges.className="badges";
    badges.textContent=summarizeABCDE(e);
    div.appendChild(badges);
    if(e.notes){const p=document.createElement("p");p.textContent="תיאור: "+e.notes;div.appendChild(p);}
    if(e.image){const a=document.createElement("a");a.href=e.image;a.target="_blank";a.textContent="📷 פתח תמונה";div.appendChild(a);}
    list.appendChild(div);
  }
}

// ================= Form Handling =================
document.getElementById("entryForm").addEventListener("submit",async ev=>{
  ev.preventDefault();
  const form=ev.currentTarget;
  const date=form.date.value;
  const title=form.title.value.trim();
  const notes=form.notes.value.trim();
  const ABCDE={};
  ["A","B","C","D","E"].forEach(k=>{
    const v=form.querySelector(`input[name=${k}]:checked`);
    if(v) ABCDE[k]=v.value;
  });
  let image="";
  if(form.photo.files && form.photo.files[0]){
    try{image=await readFileAsDataURL(form.photo.files[0]);}catch(e){}
  }
  const entry={id:Date.now()+"",date,title,notes,ABCDE,image,createdAt:Date.now()};
  const entries=loadEntries();entries.push(entry);saveEntries(entries);
  renderList();form.reset();
  ["A","B","C","D","E"].forEach(k=>{
    const el=form.querySelector(`input[name=${k}]`);if(el)el.required=true;
  });
});

// Export/Import/Clear
document.getElementById("exportBtn").addEventListener("click",()=>{
  const data=JSON.stringify(loadEntries(),null,2);
  const blob=new Blob([data],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");a.href=url;a.download="skin-entries.json";
  a.click();URL.revokeObjectURL(url);
});
document.getElementById("importBtn").addEventListener("click",()=>{document.getElementById("importFile").click();});
document.getElementById("importFile").addEventListener("change",async e=>{
  const f=e.target.files[0];if(!f)return;const txt=await f.text();
  try{const arr=JSON.parse(txt);if(Array.isArray(arr)){saveEntries(arr);renderList();}}catch{}
});
document.getElementById("clearBtn").addEventListener("click",()=>{if(confirm("למחוק הכל?")){localStorage.removeItem("skin_entries");renderList();}});

// ================= Language Switching =================
function renderLang(lang){
  const t=translations[lang];
  document.documentElement.lang=lang==="he"?"he":"ru";
  document.documentElement.dir=lang==="he"?"rtl":"ltr";
  document.getElementById("title").textContent=t.title;
  document.getElementById("note").textContent=t.note;
  document.getElementById("lblDate").textContent=t.lblDate;
  document.getElementById("lblTitle").textContent=t.lblTitle;
  document.getElementById("lblNotes").textContent=t.lblNotes;
  document.getElementById("lblPhoto").textContent=t.lblPhoto;
  document.getElementById("btnAdd").textContent=t.btnAdd;
  document.getElementById("exportBtn").textContent=t.btnExport;
  document.getElementById("importBtn").textContent=t.btnImport;
  document.getElementById("clearBtn").textContent=t.btnClear;
  document.getElementById("myRecords").textContent=t.myRecords;
  const sec=document.getElementById("abcdeSection");sec.innerHTML="";
  for(const k in t.abcde){
    const [title,opt1,opt2]=t.abcde[k];
    const fs=document.createElement("fieldset");fs.className="abcde-item";
    const lg=document.createElement("legend");lg.textContent=k+" – "+title;fs.appendChild(lg);
    [opt1,opt2].forEach((opt,i)=>{
      const label=document.createElement("label");
      const r=document.createElement("input");r.type="radio";r.name=k;r.value=opt;if(i===0)r.required=true;
      label.appendChild(r);label.append(" "+opt);fs.appendChild(label);
    });
    sec.appendChild(fs);
  }
}
document.getElementById("langSwitcher").addEventListener("change",e=>{
  renderLang(e.target.value);localStorage.setItem("skin_lang",e.target.value);
});

// Init
const savedLang=localStorage.getItem("skin_lang")||"he";
document.getElementById("langSwitcher").value=savedLang;
renderLang(savedLang);
document.getElementById("date").value=new Date().toISOString().slice(0,10);
renderList();
</script>
</body>
</html>

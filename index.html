<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>××¢×§×‘ × ×’×¢×™ ×¢×•×¨ â€“ ABCDE</title>
<style>
  :root{ --bg:#ffffff;--fg:#111;--muted:#666;--accent:#0a7cff;--card:#f6f7f9;--border:#e6e8eb }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.5;margin:0;background:var(--bg);color:var(--fg)}
  header{background:#fff;padding:12px 16px;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{margin:0;font-size:1.1rem}
  main{padding:16px;max-width:840px;margin:auto}
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin:12px 0}
  label{font-weight:600;display:block;margin-top:8px}
  input,textarea,button,select{font-size:1rem}
  input[type="date"],input[type="text"],textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff}
  textarea{min-height:80px;resize:vertical}
  .abcde-item{background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px;margin-top:8px}
  .abcde-options{display:flex;gap:14px;flex-wrap:wrap;margin-top:6px}
  .actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
  button{padding:10px 14px;border:none;border-radius:10px;cursor:pointer}
  button.primary{background:var(--accent);color:#fff;font-weight:700}
  button.secondary{background:#e9eefb;color:#0a2a5f}
  .tiny{font-size:.85rem;color:var(--muted)}
  .entry{background:#fff;border:1px solid var(--border);border-radius:10px;padding:12px;margin-top:10px}
  .entry h3{margin:.2rem 0;font-size:1rem}
  .badges{margin:4px 0;font-size:.9rem;color:#333;word-break:break-word}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .spacer{flex:1}
  .danger{background:#ffe8e8;color:#842029}
  .link-btn{display:inline-block;text-decoration:none;padding:8px 12px;border:1px solid var(--border);border-radius:10px}
</style>
</head>
<body>
<header>
  <h1 id="title">××¢×§×‘ × ×’×¢×™ ×¢×•×¨ â€“ ABCDE</h1>
  <select id="langSwitcher" aria-label="Language">
    <option value="he">×¢×‘×¨×™×ª</option>
    <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
  </select>
</header>

<main>
  <section class="card">
    <p class="tiny" id="note">×”××™×“×¢ × ×©××¨ ×œ×•×§××œ×™×ª ×‘×œ×‘×“ ×‘××›×©×™×¨ ×©×œ×š.</p>

    <form id="entryForm">
      <label for="date" id="lblDate">×ª××¨×™×š</label>
      <input id="date" name="date" type="date" required>

      <label for="title" id="lblTitle">×›×•×ª×¨×ª ×§×¦×¨×” (××•×¤×¦×™×•× ×œ×™)</label>
      <input id="title" name="title" type="text" placeholder="×œ××©×œ: ×ª×™×¢×•×“ ×¨××©×•×Ÿ">

      <label for="notes" id="lblNotes">×ª×™××•×¨/×ª×¡××™× ×™×</label>
      <textarea id="notes" name="notes" placeholder="×©×™× ×•×™×™×, ×›××‘/×’×¨×“, ×“×™××•×, ××™×§×•×..."></textarea>

      <label for="photo" id="lblPhoto">×ª××•× ×” (××•××œ×¥)</label>
      <!-- ×œ× ××›×¨×™×— ××¦×œ××”: ×××¤×©×¨ ×‘×—×™×¨×” ××¦×œ××”/×’×œ×¨×™×” -->
      <input id="photo" name="photo" type="file" accept="image/*">

      <div id="abcdeSection"></div>

      <!-- ×ª×™×‘×ª ×˜×§×¡×˜ × ×¤×ª×—×ª ×¨×§ ×× ×™×© ×©×™× ×•×™ (E) -->
      <div id="changesWrap" style="display:none;">
        <label for="changesText" id="lblChangesText">×¤×¨×˜×™ ×”×©×™× ×•×™×™×</label>
        <textarea id="changesText" name="changesText" placeholder="××” ×”×©×ª× ×”? ×’×•×“×œ, ×¦×‘×¢, ×¦×•×¨×”, ×“×™××•×..."></textarea>
      </div>

      <div class="actions">
        <button type="submit" class="primary" id="btnAdd">×”×•×¡×£/×™ ×ª×™×¢×•×“</button>
        <button type="button" class="secondary" id="exportDocBtn">×™×™×¦×•× ×œ×“×•×§ (Word)</button>
        <button type="button" class="secondary" id="importBtn">×™×™×‘×•× JSON</button>
        <input type="file" id="importFile" accept="application/json" hidden>
        <button type="button" class="secondary" id="clearBtn">××™×¤×•×¡ ×”×›×œ</button>
      </div>
    </form>
  </section>

    <section class="card">
      <h2 id="myRecords">×”×¨×©×•××•×ª ×©×œ×™</h2>
      <div id="list"></div>
    </section>
</main>

<script>
// ================= ×ª×¨×’×•××™× =================
const translations = {
  he:{
    title:"××¢×§×‘ × ×’×¢×™ ×¢×•×¨ â€“ ABCDE",
    note:"×”××™×“×¢ × ×©××¨ ×œ×•×§××œ×™×ª ×‘×œ×‘×“ ×‘××›×©×™×¨ ×©×œ×š.",
    lblDate:"×ª××¨×™×š",
    lblTitle:"×›×•×ª×¨×ª ×§×¦×¨×” (××•×¤×¦×™×•× ×œ×™)",
    lblNotes:"×ª×™××•×¨/×ª×¡××™× ×™×",
    lblPhoto:"×ª××•× ×” (××•××œ×¥)",
    lblChangesText:"×¤×¨×˜×™ ×”×©×™× ×•×™×™×",
    btnAdd:"×”×•×¡×£/×™ ×ª×™×¢×•×“",
    exportDoc:"×™×™×¦×•× ×œ×“×•×§ (Word)",
    btnImport:"×™×™×‘×•× JSON",
    btnClear:"××™×¤×•×¡ ×”×›×œ",
    myRecords:"×”×¨×©×•××•×ª ×©×œ×™",
    openImage:"ğŸ“· ×¤×ª×— ×ª××•× ×”",
    delete:"××—×™×§×”",
    confirmDelete:"×œ××—×•×§ ××ª ×”×¨×©×•××”?",
    confirmDeleteAll:"×œ××—×•×§ ××ª ×›×œ ×”×¨×©×•××•×ª?",
    noRecords:"××™×Ÿ ×¨×©×•××•×ª.",
    abcde:{
      A:["××¡×™××˜×¨×™×”","×¡×™××˜×¨×™","×œ× ×¡×™××˜×¨×™"],
      B:["×’×‘×•×œ","×’×‘×•×œ×•×ª ×‘×¨×•×¨×™×","×’×‘×•×œ ×œ× ××—×™×“/××©×•× ×Ÿ"],
      C:["×¦×‘×¢","×¦×‘×¢ ××—×™×“","××¡×¤×¨ ×¦×‘×¢×™×"],
      D:["×§×•×˜×¨","×§×˜×Ÿ ×-6 ×\"×","×’×“×•×œ ×-6 ×\"×"],
      E:["×©×™× ×•×™/×”×ª×¤×ª×—×•×ª","×œ×œ× ×©×™× ×•×™","×™×© ×©×™× ×•×™"]
    },
    labels:{
      date:"×ª××¨×™×š", title:"×›×•×ª×¨×ª", notes:"×ª×™××•×¨/×ª×¡××™× ×™×",
      abcde:"×¡×™×›×•× ABCDE", changes:"×¤×¨×˜×™ ×”×©×™× ×•×™×™×", image:"×ª××•× ×”"
    }
  },
  ru:{
    title:"ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ ĞºĞ¾Ğ¶Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ â€“ ABCDE",
    note:"Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ½Ğ° Ğ²Ğ°ÑˆĞµĞ¼ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğµ.",
    lblDate:"Ğ”Ğ°Ñ‚Ğ°",
    lblTitle:"ĞšÑ€Ğ°Ñ‚ĞºĞ¸Ğ¹ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)",
    lblNotes:"ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ/ÑĞ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹",
    lblPhoto:"Ğ¤Ğ¾Ñ‚Ğ¾ (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)",
    lblChangesText:"ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹",
    btnAdd:"Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ",
    exportDoc:"Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² DOC (Word)",
    btnImport:"Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ JSON",
    btnClear:"ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ",
    myRecords:"ĞœĞ¾Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸",
    openImage:"ğŸ“· ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ„Ğ¾Ñ‚Ğ¾",
    delete:"Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ",
    confirmDelete:"Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ?",
    confirmDeleteAll:"Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸?",
    noRecords:"Ğ—Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ½ĞµÑ‚.",
    abcde:{
      A:["ĞÑĞ¸Ğ¼Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ","Ğ¡Ğ¸Ğ¼Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡Ğ½Ğ¾Ğµ","ĞÑĞ¸Ğ¼Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡Ğ½Ğ¾Ğµ"],
      B:["Ğ“Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°","Ğ§Ñ‘Ñ‚ĞºĞ°Ñ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°","ĞĞµÑ‡Ñ‘Ñ‚ĞºĞ°Ñ/Ğ½ĞµÑ€Ğ¾Ğ²Ğ½Ğ°Ñ"],
      C:["Ğ¦Ğ²ĞµÑ‚","ĞĞ´Ğ¸Ğ½ Ñ†Ğ²ĞµÑ‚","ĞĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ†Ğ²ĞµÑ‚Ğ¾Ğ²"],
      D:["Ğ”Ğ¸Ğ°Ğ¼ĞµÑ‚Ñ€","ĞœĞµĞ½ÑŒÑˆĞµ 6 Ğ¼Ğ¼","Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ 6 Ğ¼Ğ¼"],
      E:["Ğ­Ğ²Ğ¾Ğ»ÑÑ†Ğ¸Ñ","Ğ‘ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹","Ğ•ÑÑ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ"]
    },
    labels:{
      date:"Ğ”Ğ°Ñ‚Ğ°", title:"Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº", notes:"ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ/ÑĞ¸Ğ¼Ğ¿Ñ‚Ğ¾Ğ¼Ñ‹",
      abcde:"Ğ¡Ğ²Ğ¾Ğ´ĞºĞ° ABCDE", changes:"ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹", image:"Ğ¤Ğ¾Ñ‚Ğ¾"
    }
  }
};

// ================= ×¢×–×¨ =================
const LS_KEY_ENTRIES = "skin_entries";
const LS_KEY_LANG = "skin_lang";

function readFileAsDataURL(file){
  return new Promise((resolve,reject)=>{
    const r=new FileReader();
    r.onload=()=>resolve(r.result);
    r.onerror=reject;
    r.readAsDataURL(file);
  });
}

function saveEntries(entries){ localStorage.setItem(LS_KEY_ENTRIES, JSON.stringify(entries)); }
function loadEntries(){
  try { return JSON.parse(localStorage.getItem(LS_KEY_ENTRIES) || "[]"); }
  catch(e){ return []; }
}

function summarizeABCDE(entry){
  return ["A","B","C","D","E"].map(k=>k+": "+(entry.ABCDE?.[k]||"?")).join(" | ");
}

function currentLang(){ return document.getElementById("langSwitcher").value || "he"; }
function t(){ return translations[currentLang()]; }

// ××—×™×§×” ×œ×¤×™ ××–×”×” (×¢× ×¨×™×¢× ×•×Ÿ)
function deleteEntry(id){
  const entries = loadEntries().filter(e => e.id !== id);
  saveEntries(entries);
  renderList();
}

// ================= ×¨×©×™××” =================
function renderList(){
  const tr = t();
  const list = document.getElementById("list");
  const entries = loadEntries().sort((a,b)=> (b.createdAt||0)-(a.createdAt||0));
  list.innerHTML = "";

  if(entries.length===0){
    list.innerHTML = `<p class="tiny">${tr.noRecords}</p>`;
    return;
  }

  // ×‘× ×™×™×ª DOM + data-id ×œ××—×™×§×”
  for(const e of entries){
    const div = document.createElement("div");
    div.className = "entry";
    div.dataset.id = e.id;

    const h = document.createElement("h3");
    h.textContent = `${e.date || ""}${e.title ? " â€“ " + e.title : ""}`;
    div.appendChild(h);

    const badges = document.createElement("div");
    badges.className = "badges";
    badges.textContent = summarizeABCDE(e);
    div.appendChild(badges);

    if(e.notes){
      const p = document.createElement("p");
      p.textContent = `${tr.labels.notes}: ${e.notes}`;
      div.appendChild(p);
    }

    if(e.changesText){
      const p2 = document.createElement("p");
      p2.textContent = `${tr.labels.changes}: ${e.changesText}`;
      div.appendChild(p2);
    }

    const row = document.createElement("div");
    row.className = "row";

    if(e.image){
      const a = document.createElement("a");
      a.href = e.image;
      a.target = "_blank";
      a.rel = "noopener";
      a.className = "link-btn";
      a.textContent = tr.openImage;
      row.appendChild(a);
    }

    row.appendChild(Object.assign(document.createElement("div"),{className:"spacer"}));

    const delBtn = document.createElement("button");
    delBtn.type = "button";
    delBtn.className = "danger delete-btn";
    delBtn.textContent = tr.delete;
    row.appendChild(delBtn);

    div.appendChild(row);
    list.appendChild(div);
  }
}

// ×”××–× ×ª ××—×™×§×” ××¨×•×›×–×ª (Event Delegation) â€“ ×›×š ×–×” ×™×¢×‘×•×“ ×ª××™×“
document.getElementById("list").addEventListener("click", (ev)=>{
  const tr = t();
  const btn = ev.target.closest(".delete-btn");
  if(!btn) return;
  const card = ev.target.closest(".entry");
  if(!card) return;
  const id = card.dataset.id;
  if(id && confirm(tr.confirmDelete)){ deleteEntry(id); }
});

// ================= ABCDE =================
function getFormSelections(){
  const sel = {};
  ["A","B","C","D","E"].forEach(k=>{
    const checked = document.querySelector(`#entryForm input[name="${k}"]:checked`);
    if(checked) sel[k] = checked.value;
  });
  sel.date = document.getElementById("date").value;
  sel.title = document.getElementById("title").value;
  sel.notes = document.getElementById("notes").value;
  sel.changesText = document.getElementById("changesText")?.value || "";
  return sel;
}

function restoreFormSelections(sel){
  document.getElementById("date").value = sel.date || new Date().toISOString().slice(0,10);
  document.getElementById("title").value = sel.title || "";
  document.getElementById("notes").value = sel.notes || "";
  document.getElementById("changesText").value = sel.changesText || "";
  toggleChangesBox(isChangeValue(sel.E));
}

function isChangeValue(v){
  return v && (v === "×™×© ×©×™× ×•×™" || v === "Ğ•ÑÑ‚ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ");
}

function buildABCDE(lang){
  const tr = translations[lang];
  const sec = document.getElementById("abcdeSection");
  sec.innerHTML = "";

  for(const k of ["A","B","C","D","E"]){
    const [title,opt1,opt2] = tr.abcde[k];
    const fs = document.createElement("fieldset");
    fs.className = "abcde-item";

    const lg = document.createElement("legend");
    lg.textContent = `${k} â€“ ${title}`;
    fs.appendChild(lg);

    const opts = document.createElement("div");
    opts.className = "abcde-options";

    const mk = (opt, req) => {
      const label = document.createElement("label");
      const r = document.createElement("input");
      r.type = "radio"; r.name = k; r.value = opt; if(req) r.required = true;
      label.appendChild(r); label.append(" " + opt);
      return label;
    };

    opts.appendChild(mk(opt1, true));
    opts.appendChild(mk(opt2, false));
    fs.appendChild(opts);
    sec.appendChild(fs);
  }
}

// ×ª×™×‘×ª ×”×©×™× ×•×™×™× â€“ × ×¤×ª×—×ª/× ×¡×’×¨×ª
function toggleChangesBox(show){
  document.getElementById("changesWrap").style.display = show ? "block" : "none";
}

// ×××–×™×Ÿ ×’×œ×•×‘×œ×™ ×œ×©×™× ×•×™ ×‘-E ×›×“×™ ×©×œ× ×™×ª×‘×˜×œ ×œ×¢×•×œ×
document.addEventListener("change", (e)=>{
  if(e.target && e.target.name === "E"){
    toggleChangesBox(isChangeValue(e.target.value));
  }
});

// ================= ×˜×•×¤×¡ =================
document.getElementById("entryForm").addEventListener("submit", async (ev)=>{
  ev.preventDefault();
  const form = ev.currentTarget;
  const date = form.date.value || new Date().toISOString().slice(0,10);
  const title = form.title.value.trim();
  const notes = form.notes.value.trim();
  const ABCDE = {};
  ["A","B","C","D","E"].forEach(k=>{
    const v = form.querySelector(`input[name="${k}"]:checked`);
    if(v) ABCDE[k] = v.value;
  });

  let changesText = "";
  if(isChangeValue(ABCDE.E)){
    changesText = (document.getElementById("changesText").value || "").trim();
  }

  let image = "";
  if(form.photo.files && form.photo.files[0]){
    try { image = await readFileAsDataURL(form.photo.files[0]); } catch(e){}
  }

  const entry = {
    id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now() + Math.random()),
    date, title, notes, ABCDE, changesText, image,
    createdAt: Date.now()
  };

  const entries = loadEntries();
  entries.push(entry);
  saveEntries(entries);

  renderList();
  form.reset();
  buildABCDE(currentLang());
  toggleChangesBox(false);
  document.getElementById("date").value = new Date().toISOString().slice(0,10);
});

// ================= ×™×™×‘×•×/××™×¤×•×¡ =================
document.getElementById("importBtn").addEventListener("click", ()=> document.getElementById("importFile").click());
document.getElementById("importFile").addEventListener("change", async (e)=>{
  const f = e.target.files[0]; if(!f) return;
  try{
    const txt = await f.text();
    const arr = JSON.parse(txt);
    if(Array.isArray(arr)){ saveEntries(arr); renderList(); }
  }catch(err){ alert("Import failed"); }
});

document.getElementById("clearBtn").addEventListener("click", ()=>{
  const tr = t();
  if(confirm(tr.confirmDeleteAll)){ localStorage.removeItem(LS_KEY_ENTRIES); renderList(); }
});

// ================= ×™×™×¦×•× ×œ×“×•×§ (Word) =================
// ×™×•×¦× ×§×•×‘×¥ .doc (HTML) ×©×›×œ ×¨×©×•××” ×‘×¢××•×“ ××©×œ×” + ×ª××•× ×” ××•×§×˜× ×ª (×¨×•×—×‘ 400px)
document.getElementById("exportDocBtn").addEventListener("click", ()=>{
  const tr = t();
  const entries = loadEntries().sort((a,b)=> (a.createdAt||0)-(b.createdAt||0)); // ×›×¨×•× ×•×œ×•×’×™
  if(entries.length===0){ alert(tr.noRecords); return; }

  const L = tr.labels;
  const dir = document.documentElement.dir || "rtl";
  const lang = document.documentElement.lang || "he";

  let html = `<!DOCTYPE html>
<html lang="${lang}" dir="${dir}">
<head><meta charset="utf-8">
<style>
  body{font-family:Arial,Helvetica,sans-serif;line-height:1.4}
  .page{page-break-after:always;margin:2cm;}
  h2{margin:0 0 .4rem 0}
  .row{margin:.2rem 0}
  .lbl{font-weight:bold}
  img{max-width:400px;height:auto;display:block;margin:.4rem 0;border:1px solid #ccc;padding:2px}
  .mono{font-family:ui-monospace,Consolas,monospace}
</style>
</head><body>`;

  entries.forEach((e, idx)=>{
    const abcde = summarizeABCDE(e);
    const imgTag = e.image ? `<img src="${e.image}" alt="image-${idx+1}">` : "";
    const titleLine = [e.date || "", e.title || ""].filter(Boolean).join(" â€“ ");
    const changesLine = e.changesText ? `<div class="row"><span class="lbl">${L.changes}:</span> ${escapeHtml(e.changesText)}</div>` : "";

    html += `<div class="page">
  <h2>${escapeHtml(titleLine || (L.date + ": " + (e.date||"")))}</h2>
  <div class="row"><span class="lbl">${L.date}:</span> ${escapeHtml(e.date||"")}</div>
  <div class="row"><span class="lbl">${L.title}:</span> ${escapeHtml(e.title||"")}</div>
  <div class="row"><span class="lbl">${L.notes}:</span> ${escapeHtml(e.notes||"")}</div>
  <div class="row"><span class="lbl">${L.abcde}:</span> <span class="mono">${escapeHtml(abcde)}</span></div>
  ${changesLine}
  ${imgTag}
</div>`;
  });

  html += `</body></html>`;

  const blob = new Blob(['\ufeff', html], {type:'application/msword;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "skin-entries.doc";
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 1000);
});

function escapeHtml(s){
  return String(s||"").replace(/[&<>"]/g, ch =>
    ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[ch])
  );
}

// ================= ×©×¤×” =================
function applyLanguage(lang){
  const tr = translations[lang];

  document.documentElement.lang = (lang==="he") ? "he" : "ru";
  document.documentElement.dir  = (lang==="he") ? "rtl" : "ltr";

  document.getElementById("title").textContent = tr.title;
  document.getElementById("note").textContent  = tr.note;
  document.getElementById("lblDate").textContent  = tr.lblDate;
  document.getElementById("lblTitle").textContent = tr.lblTitle;
  document.getElementById("lblNotes").textContent = tr.lblNotes;
  document.getElementById("lblPhoto").textContent = tr.lblPhoto;
  document.getElementById("lblChangesText").textContent = tr.lblChangesText;
  document.getElementById("btnAdd").textContent   = tr.btnAdd;
  document.getElementById("exportDocBtn").textContent = tr.exportDoc;
  document.getElementById("importBtn").textContent= tr.btnImport;
  document.getElementById("clearBtn").textContent = tr.btnClear;
  document.getElementById("myRecords").textContent= tr.myRecords;

  const sel = getFormSelections();
  buildABCDE(lang);

  // ×œ×©×—×–×¨ ×‘×—×™×¨×•×ª ×¨×“×™×• ×‘×”×ª×× ×œ×¢×¨×š, ×•×œ×¤×ª×•×— ×ª×™×‘×ª ×©×™× ×•×™×™× ×× ×¦×¨×™×š
  ["A","B","C","D","E"].forEach(k=>{
    if(sel[k]){
      const radios = Array.from(document.querySelectorAll(`#entryForm input[name="${k}"]`));
      const match = radios.find(r => r.value === sel[k]);
      if(match){ match.checked = true; }
    }
  });
  restoreFormSelections(sel);

  renderList();
}

document.getElementById("langSwitcher").addEventListener("change", e=>{
  const lang = e.target.value;
  localStorage.setItem(LS_KEY_LANG, lang);
  applyLanguage(lang);
});

// ================= Init =================
const savedLang = localStorage.getItem(LS_KEY_LANG) || "he";
document.getElementById("langSwitcher").value = savedLang;
buildABCDE(savedLang);
applyLanguage(savedLang);
document.getElementById("date").value = new Date().toISOString().slice(0,10);
renderList();
</script>
</body>
</html>
